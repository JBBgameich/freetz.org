<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  


  <head>
    <title>
      packages/nhipt.en – Freetz
    </title>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="/search" />
        <link rel="help" href="../TracGuide.html" />
        <link rel="alternate" href="nhipt.en%3Fformat=txt" type="text/x-trac-wiki" title="Reiner Text" />
        <link rel="up" href="../packages.html" title="Übergeordnete Wiki-Seite anzeigen" />
        <link rel="start" href="/wiki" />
        <link rel="stylesheet" href="../../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../../chrome/common/css/wiki.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikiextras/css/phrases.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikiextras/css/boxes.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikiextras/css/boxes-300.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikiextras/css/boxes-narrow-toc.css" type="text/css" /><link rel="stylesheet" href="../../wikicss.css" type="text/css" /><link rel="stylesheet" href="../../chrome/tags/css/tractags.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikinegotiator/css/langmenu-ctxnav.css" type="text/css" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="/favicon.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="/search/opensearch" title="Freetz durchsuchen" />
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/jquery.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/babel.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/messages/de.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/trac.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/search.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/folding.js"></script>
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("#content").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $("#content").find(".wikianchor").each(function() {
          $(this).addAnchor(babel.format(_("Link to #%(id)s"), {id: $(this).attr('id')}));
        });
        $(".foldable").enableFolding(true, true);
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="/wiki"><img src="../../chrome/common/freetz_motd.png" alt="Freetz" /></a>
      </div>
      <form id="search" action="/search" method="get">
        <div>
          <label for="proj-search">Suche:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Suche" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="/login">Anmelden</a></li><li><a href="/prefs">Einstellungen</a></li><li><a href="../TracGuide.html">Hilfe/Anleitung</a></li><li><a href="/about">Über Trac</a></li><li><a href="/notification" title="Wiki Pages Change Notifications">My Notifications</a></li><li><a href="/register">Registrieren</a></li><li class="last"><a href="../Impressum.html">Impressum</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="/wiki">Wiki</a></li><li><a href="/timeline">Journal</a></li><li><a href="/roadmap">Projektplan</a></li><li><a href="/browser">Quellen durchsehen</a></li><li><a href="/report">Tickets anzeigen</a></li><li><a href="/search">Suche</a></li><li><a href="/tags">Tags</a></li><li><a href="/downloads">Downloads</a></li><li class="last"><a href="/screenshots">Bildschirmfotos</a></li>
    </ul>
  </div>
    <div id="langmenu"><ul><li class="first"><span title="Select a language of wiki content">Language:</span></li><li class=""><a class="" href="nhipt..html" title="">German</a></li><li class=" active last"><a class="selected" href="nhipt.en.html" title="selected and displaying language">English</a></li></ul></div><div id="main">
      <div id="pagepath" class="noprint">
  <a class="pathentry first" title="Zeige WikiStart an" href="/wiki">Wiki:</a><a class="pathentry" href="../packages.html" title="Zeige packages an">packages</a><span class="pathentry sep">/</span><a class="pathentry" href="nhipt.en.html" title="Zeige packages/nhipt.en an">nhipt.en</a>
</div>
      <div id="ctxtnav" class="nav">
        <h2>Kontext-Navigation</h2>
        <ul>
          <li class="first"><a href="../packages.html">Aufwärts</a></li><li><a href="../WikiStart.html">Startseite</a></li><li><a href="../TitleIndex.html">Inhaltsverzeichnis</a></li><li><a href="nhipt.en%3Faction=history.html">Änderungshistorie</a></li><li class="last"><a href="/notification/packages/nhipt.en" title="Watch Page">Watch Page</a></li>
        </ul>
        <hr />
      </div>
    <div id="content" class="wiki">
      <div class="wikipage searchable">
        
          <div id="wikipage" class="trac-content"><p>
</p><div class="wiki-toc"><h4>Table of contents</h4><ol><li><a href="nhipt.en.html#MOTIVATION">MOTIVATION</a></li><li><a href="nhipt.en.html#PREREQUISITES:">PREREQUISITES:</a></li><li><a href="nhipt.en.html#YOUHAVETHECHOICEOF3INSTALLOPTIONS:">YOU HAVE THE CHOICE OF 3 INSTALL OPTIONS:</a><ol><li><a href="nhipt.en.html#nhipt.cgi.version.tar.gz">nhipt.cgi.(version).tar.gz</a></li><li><a href="nhipt.en.html#ipt.version.tar.gz">ipt.(version).tar.gz</a></li><li><a href="nhipt.en.html#usemakemenuconfig">use <em>make menuconfig</em></a></li></ol></li><li><a href="nhipt.en.html#BEHINDTHESCENES:">BEHIND THE SCENES:</a><ol><li><a href="nhipt.en.html#Furtherinformation:">Further information:</a></li><li><a href="nhipt.en.html#Bootprocess">Boot process</a></li><li><a href="nhipt.en.html#configfile">config file</a></li><li><a href="nhipt.en.html#filescontainedinthefreetzpackage">files contained in the freetz package</a></li></ol></li><li><a href="nhipt.en.html#RECOMMENDATIONS:">RECOMMENDATIONS:</a></li><li><a href="nhipt.en.html#DOWNLOAD">DOWNLOAD</a></li></ol></div><p>
</p>
<h1 id="NHIPT-iptablesfirewallGUI">NHIPT - iptables firewall GUI</h1>
<h2 id="MOTIVATION">MOTIVATION</h2>
<blockquote>
<p>
iptables is a command-line interface for configuring the high - sophisticated <a class="ext-link" href="http://de.wikipedia.org/wiki/Netfilter/iptables"><span class="icon">​</span>netfilter</a> Linux kernel firewall. The nhipt web front-end exposes the whole potential of iptables in a user-friendly UI of your FritzBox and leverages this consumer device to the level of a professional firewall, supporting both IPv4 &amp; IPv6 Layer-3 protocols. The UI can be either integrated in your firmware image or run stand-alone externally from an attached device (e.g. USB-Stick).
</p>
</blockquote>
<h2 id="PREREQUISITES:">PREREQUISITES:</h2>
<ul><li>iptables have to be <strong><em>installed and running</em></strong>. <br /> It is recommended to build at least the following kernel modules in your firmware image (the more you choose, the more fun you'll have):
</li></ul><blockquote>
<table class="wiki">
<tr><td> * ip_tables <br /> * x_tables<br /> * iptable_filter <br /> <br /> </td><td>  * ip_conntrack <br /> * ip_conntrack_ftp <br /> * ip_conntrack_tftp <br /> <br /> </td><td> * ipt_log <br /> * ipt_REJECT <br /> * ipt_iprange <br /> <br /> </td><td> * xt_state <br /> * xt_conntrack <br /> * xt_multiport <br /> * xt_tcpudp <br /> 
</td></tr></table>
</blockquote>
<blockquote>
<p>
<strong> !!! Please don't forget to include the according shared libraries too in your firmware image !!!  </strong> 
</p>
</blockquote>
<blockquote>
<p>
The ideal build includes a replaced kernel with autoload kernel modules enabled (<strong>make kernel-menuconfig</strong> &rarr; <strong>L</strong>oadable modules support &rarr; <strong>A</strong>utomatic kernel module loading). <br />
Prior to first use you must start iptables either by : <strong>iptables -S</strong>  <em>(if you have a replaced kernel with automatic kernel modules loading)</em> <br />
or (whithout autoload) by using <strong>modprobe &lt;modulname&gt;</strong> for each module.  <br />
</p>
</blockquote>
<h2 id="YOUHAVETHECHOICEOF3INSTALLOPTIONS:">YOU HAVE THE CHOICE OF 3 INSTALL OPTIONS:</h2>
<h3 id="nhipt.cgi.version.tar.gz">nhipt.cgi.(version).tar.gz</h3>
<blockquote>
<p>
This is the naked GUI - you can run it directly from an USB stick, without the integration in freetz.
</p>
</blockquote>
<p>
<strong>Installation:</strong>
</p>
<ul><li>copy the file <strong>nhipt.cgi</strong> to your stick (e.g. to: /var/media/ftp/uStor01/<strong>ipt/cgi-bin</strong>) <br />
</li><li>set execute permissions to the file. <br />
</li><li>set up the httpd deamon for the UI on the folder above of the cgi-bin (e.g. to<strong>/ipt</strong>) and use a free tcp port (e.g. 83).<br />
</li></ul><pre class="wiki">chmod +x /var/media/ftp/uStor01/ipt/cgi-bin/nhipt.cgi
httpd -P /var/run/nhipt.pid -p 83 -h /var/media/ftp/uStor01/ipt
</pre><blockquote>
<blockquote>
<p>
Now you can access the UI via <a class="ext-link" href="http://fritz.box:83/cgi-bin/nhipt.cgi"><span class="icon">​</span>http://fritz.box:83/cgi-bin/nhipt.cgi</a>
</p>
</blockquote>
</blockquote>
<h3 id="ipt.version.tar.gz">ipt.(version).tar.gz</h3>
<blockquote>
<p>
The external comfort package with freetz integration 
</p>
</blockquote>
<p>
<strong>Installation: </strong>
</p>
<ul><li>unpack to <strong>/var/media/ftp/uStor01/</strong>.<br />
</li><li>set execute permissions to <strong>register.sh</strong><br />
</li><li>run <strong>register.sh</strong> <br />
</li></ul><pre class="wiki">chmod +x /var/media/ftp/uStor01/ipt/register.sh
. /var/media/ftp/uStor01/ipt/register.sh
</pre><blockquote>
<blockquote>
<p>
Now you should have a brand-new package in the freetz UI, where you can configure all the installation options.
</p>
</blockquote>
</blockquote>
<h3 id="usemakemenuconfig">use <em>make menuconfig</em></h3>
<blockquote>
<p>
Install the UI permanent in your firmware using the recent trunk.
</p>
</blockquote>
<p>
<strong>Installation: </strong>
</p>
<blockquote>
<p>
start with <strong>make menuconfig</strong>, go to <strong>P</strong>ackage Selection &rarr; <strong>W</strong>eb Interface &rarr; select option <strong>NHIPT Iptables CGI</strong>.<br />
Now you get all iptables modules listed for your convenience. Make your selections and create your firmware the usual way.
</p>
</blockquote>
<h2 id="BEHINDTHESCENES:">BEHIND THE SCENES:</h2>
<h3 id="Furtherinformation:">Further information:</h3>
<ul><li><a class="wiki" href="iptables.en.html">iptables Wiki for beginners</a><br />
</li><li><a class="ext-link" href="http://technet.microsoft.com/en-us/library/cc959833%28printer%29.aspx"><span class="icon">​</span>Windows Ports &amp; Services</a><br />
</li></ul><blockquote>
<p>
The interface reads interactively the current rule set of your firewall and enables you to edit all rules, tables, chains, policies etc. online and life! This means, after submitting your changes the new rule immediately takes effect. The bad news are: You can accidentally lock out yourself - the good news are: it does not matter - the rule is not persistently saved - just reboot your box to the last known good rule set. When you have finished playing around with your rules and everything works as you like it you can click on <strong>[Persist rules]</strong> to save your work permanently and reboot-resistant either to the flash memory of the box or to the attached USB device <strong>[BOOT FROM FLASH / USB] + [SET BOOT DIRECTORY]</strong>. You can either use the guided UI to alter / add your rules for each chain or you can enter your rules using the command line expert interface on top.
To add additional tables and modules use the selection checkboxes or modprobe them by hand in the expert UI. If you have ipv6 enabled and loaded, the UI also shows you the filter tables for ipv6.
</p>
</blockquote>
<blockquote>
<p>
For security reason you can limit the access to the UI to a dedicated Admin-IP or Admin-IP-Range using: <strong>[SET / CHANGE ADMIN IP]</strong>.
</p>
</blockquote>
<blockquote>
<p>
For the DECT boxes there is an option to set up an internal log deamon to catch the deviated kernel messages and present them in the UI. The log directory can be set up to any writeable destination.
</p>
</blockquote>
<blockquote>
<p>
Error and system messages are shown in the bottom lines of the UI for your information, status 0 means OK.
</p>
</blockquote>
<h3 id="Bootprocess">Boot process</h3>
<ul><li><strong>debug.cfg</strong> can be used to bootstrap the iptables rulset.<br />
</li><li><strong>rc.nhipt load</strong> is called by <strong>rc.mod</strong> / <strong>run level 20</strong> and checks, if debug.cfg has startet the firewall, otherwise <em>/tmp/flash/nhiptboot.cfg</em> is called to initialize the firewall <br />
</li><li><strong>debug.cfg</strong> and <strong>nhiptboot.cfg</strong> use the same script settings and
<ul><li>wait - if configured for USB ready or time-out<br />
</li><li>copy the settings file <strong>nhipt.par</strong> as configured from the source (flash / USB) to the RAM disc<br />
</li><li>copy the start script <strong>nhipt.cfg</strong> to the RAM disc<br />
</li><li>run the start script <strong>nhipt.cfg</strong> detached in the background.<br />
</li></ul></li><li><strong>nhipt.cfg</strong>:
<ul><li>stop dsld if configured for security reason<br />
</li><li>wait for delay timer (if configured to prevent mistakenly lock-out)<br />
</li><li>start dsld if configured<br />
</li><li>start Web-Server for the UI <br />
</li><li>start internal log-deamon if configured <br />
</li><li>load all saved rules<br />
</li></ul></li></ul><blockquote>
<blockquote>
<p>
<strong>Scenario 1:</strong> stand-alone CGI - boots always from <em>debug.cfg</em>, rules can be saved either to the flash or to the usb stick.
</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>
<strong>Scenario 2:</strong> dynamic freetz - boots either from <em>debug.cfg</em> or delayed from  <em>freetz rc.custom</em> (rc.custom is used to re-integrate the dynamic modules in freetz after reboot)
</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>
<strong>Scenario 3:</strong> <em>Runlevel of Freetz</em> - integrated start-up, optional <em>debug.cfg</em> can be used for early protection.
</p>
</blockquote>
</blockquote>
<h3 id="configfile">config file</h3>
<p>
At run-time you'll find it here: <em>/var/tmp/nhipt.par</em>, persistently stored at BOOTDIR along with the <em>nhipt.cfg</em><br />
</p>
<pre class="wiki">BACK=/var/media/ftp/uStor01/save
CHANGED=0
DELAY=0
LOGTARGET=internal
DSLDOFF=0
ADMINIP=
LOGD=/var/media/ftp/uStor01/log
AIRBAG=0
MYIP=
BOOTSTRAP=freetz
PORT=83
BOOT=flash
BOOTDIR=/tmp/flash
ROOT=/usr/ipt
</pre><h3 id="filescontainedinthefreetzpackage">files contained in the freetz package</h3>
<pre class="wiki">/etc/default.nhipt/nhipt.cfg       rwxrwxrwx    # config for freetz UI
/etc/init.d/rc.nhipt               r-xr-xr-x    # call-back for freetz UI, boot loader
/usr/ipt/index.html                r--r--r--    # frameset for UI
/usr/ipt/cgi-bin/nhipt.cgi         r-xr-xr-x    # the CGI for iptables
/lib/cgi-bin/nhipt.cgi             r-xr-xr-x    # the CGI for freetz settings
</pre><h2 id="RECOMMENDATIONS:">RECOMMENDATIONS:</h2>
<p>
Unexperianced users should read this carefully to prevent permanent lock-outs.
</p>
<p>
Firewalls protect systems from intruders based on rules and policies. They are obeyed by the system - the system cannot guess who is good and who's bad. Eventually even experienced firewall admin's can lock themselves out. It is good to know, how to recover from this in advance. 
</p>
<blockquote>
<p>
The following hints can make your life easier:
</p>
</blockquote>
<ul><li>you can look at all scripts - but don't change them manually, if you are not certain what they do exactly.<br />
</li><li>save rule sets permanently only if everything works as it should - test at least your admin access to the box. Use the BackUp Option so you can start over from a known-good set-up.<br />
</li><li>Use in the beginning the usb stick as boot target. If you lock-out yourself - just pull out the stick and reboot. No iptables will be loaded! <br />
</li><li>For Newbees there is a <strong>[safe]</strong> Mode. The firewall automatically takes care, that under all circumstances the Admin-IP will not be locked-out from the box (IPv4 only).<br />
</li><li>switching back to <strong>[advanced]</strong> lets you remove this safety rules later. <br />
</li><li>use the <strong>[Boot-Delay]</strong> option - this gives you some time to login and kill your naughty rule-set.<br />
</li><li>if you enter a wrong Admin-IP and lock yourself out from the UI - no problem. Use freetz UI to fix or edit <strong>/var/tmp/nhipt.par</strong> - Delete the ADMINIP= Entry.<br />
</li><li>if you ignore all this hints and finally lock yourself - the last chance is to flash a brand new image without iptables and delete the rules manually.<br />
</li></ul><h2 id="DOWNLOAD">DOWNLOAD</h2>
<blockquote>
<p>
The latest version can be downloaded here: <a class="ext-link" href="http://www.ip-phone-forum.de/showpost.php?p=1420252&amp;postcount=1"><span class="icon">​</span>IPPF Forum</a>, there are also tons of information to read in the forum.
</p>
</blockquote>
</div>
          
          <div class="trac-modifiedby">
            <span><a href="nhipt.en%3Faction=diff&amp;version=9.html" title="Version 9 von oliver: Fix link">zuletzt geändert</a> <a class="timeline" href="/timeline?from=2010-05-27T13%3A11%3A02Z&amp;precision=second" title="Siehe Journal am 27.05.2010 13:11:02">vor 8 Jahren</a></span>
            <span class="trac-print">Zuletzt geändert am 27.05.2010 13:11:02</span>
          </div>
        
        
      </div>
      

    </div>
    <div id="altlinks">
      <h3>In anderen Formaten herunterladen:</h3>
      <ul>
        <li class="last first">
          <a rel="nofollow" href="nhipt.en%3Fformat=txt">Reiner Text</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Betrieben mit <a href="/about"><strong>Trac 1.0.1</strong></a><br />
        von <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right"><div class="field" align="right"><form action="https://www.paypal.com/cgi-bin/webscr" method="post"><input type="hidden" name="cmd" value="_donations"/><input type="hidden" name="business" value="spenden@freetz.org"/><input type="hidden" name="item_name" value="Freetz Entwickler-Team"/><input type="hidden" name="no_shipping" value="1"/><input type="hidden" name="return" value="http://freetz.org"/><input type="hidden" name="cn" value="Name oder IPPF-Pseudonym"/><input type="hidden" name="currency_code" value="EUR"/><input type="hidden" name="tax" value="0"/><input type="hidden" name="lc" value="DE"/><input type="hidden" name="bn" value="PP-DonationsBF"/><input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="Zahlen Sie mit PayPal - schnell, kostenlos und sicher!"/><img alt="" border="0" src="/pixel.gif" width="1" height="1"/></form></div></p>
    </div>
  </body>
</html>