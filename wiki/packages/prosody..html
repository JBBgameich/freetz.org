<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  


  <head>
    <title>
      packages/prosody – Freetz
    </title>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="/search" />
        <link rel="help" href="../TracGuide.html" />
        <link rel="alternate" href="prosody%3Fformat=txt" type="text/x-trac-wiki" title="Reiner Text" />
        <link rel="up" href="../packages.html" title="Übergeordnete Wiki-Seite anzeigen" />
        <link rel="start" href="/wiki" />
        <link rel="stylesheet" href="../../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../../chrome/common/css/wiki.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikiextras/css/phrases.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikiextras/css/boxes.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikiextras/css/boxes-300.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikiextras/css/boxes-narrow-toc.css" type="text/css" /><link rel="stylesheet" href="../../wikicss.css" type="text/css" /><link rel="stylesheet" href="../../chrome/tags/css/tractags.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikinegotiator/css/langmenu-ctxnav.css" type="text/css" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="/favicon.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="/search/opensearch" title="Freetz durchsuchen" />
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/jquery.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/babel.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/messages/de.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/trac.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/search.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/folding.js"></script>
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("#content").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $("#content").find(".wikianchor").each(function() {
          $(this).addAnchor(babel.format(_("Link to #%(id)s"), {id: $(this).attr('id')}));
        });
        $(".foldable").enableFolding(true, true);
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="/wiki"><img src="../../chrome/common/freetz_motd.png" alt="Freetz" /></a>
      </div>
      <form id="search" action="/search" method="get">
        <div>
          <label for="proj-search">Suche:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Suche" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="/login">Anmelden</a></li><li><a href="/prefs">Einstellungen</a></li><li><a href="../TracGuide.html">Hilfe/Anleitung</a></li><li><a href="/about">Über Trac</a></li><li><a href="/notification" title="Wiki Pages Change Notifications">My Notifications</a></li><li><a href="/register">Registrieren</a></li><li class="last"><a href="../Impressum.html">Impressum</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="/wiki">Wiki</a></li><li><a href="/timeline">Journal</a></li><li><a href="/roadmap">Projektplan</a></li><li><a href="/browser">Quellen durchsehen</a></li><li><a href="/report">Tickets anzeigen</a></li><li><a href="/search">Suche</a></li><li><a href="/tags">Tags</a></li><li><a href="/downloads">Downloads</a></li><li class="last"><a href="/screenshots">Bildschirmfotos</a></li>
    </ul>
  </div>
    <div id="langmenu"><ul><li class="first"><span title="Select a language of wiki content">Language:</span></li><li class=" active"><a class="" href="prosody..html" title="displaying language (default)">German</a></li><li class=" last"><a class="" href="prosody.en.html" title="">English</a></li></ul></div><div id="main">
      <div id="pagepath" class="noprint">
  <a class="pathentry first" title="Zeige WikiStart an" href="/wiki">Wiki:</a><a class="pathentry" href="../packages.html" title="Zeige packages an">packages</a><span class="pathentry sep">/</span><a class="pathentry" href="prosody.html" title="Zeige packages/prosody an">prosody</a>
</div>
      <div id="ctxtnav" class="nav">
        <h2>Kontext-Navigation</h2>
        <ul>
          <li class="first"><a href="../packages.html">Aufwärts</a></li><li><a href="../WikiStart.html">Startseite</a></li><li><a href="../TitleIndex.html">Inhaltsverzeichnis</a></li><li><a href="prosody%3Faction=history.html">Änderungshistorie</a></li><li class="last"><a href="/notification/packages/prosody." title="Watch Page">Watch Page</a></li>
        </ul>
        <hr />
      </div>
    <div id="content" class="wiki">
      <div class="wikipage searchable">
        
          <div id="wikipage" class="trac-content"><h1 id="ProsodyIM">Prosody IM</h1>
<p>
"<em>Prosody ist ein flexibler Jabber/XMPP-Server, geschrieben in der Skriptsprache Lua. Die Ziele von Prosody sind einfache Bedienbarkeit und geringe Systemauslastung.</em>"
</p>
<p>
<strong><em>Dieses Paket ist in Arbeit! </em></strong>
</p>
<h2 id="Konfiguration">Konfiguration</h2>
<p>
Zunächst kopieren wir uns die Beispielkonfiguration aus /var/mod/etc/:
</p>
<pre class="wiki">cp /var/mod/etc/prosody.cfg.lua /var/tmp/flash/mod/prosody.cfg.lua
</pre><p>
Diese können wir dann mit vi bearbeiten:
</p>
<pre class="wiki">vi /var/tmp/flash/mod/prosody.cfg.lua
</pre><h3 id="VirtualHosthinzufügen">VirtualHost hinzufügen</h3>
<p>
Zunächst sollte man einen VirtualHost konfigurieren, dazu verändert man man die "example.com" in die gewünschte Domain und entfernt das enabled = false
</p>
<pre class="wiki">VirtualHost "example.com"
        enabled = false -- Remove this line to enable this host

</pre><h3 id="SSLverwenden">SSL verwenden</h3>
<p>
Wenn man SSL verwenden möchte, benötigt man eine Zertifikat und einen Schlüssel, diese kann man mit OpenSSL erstellen und auf ein externes Speichermedium (z.B. USB-Stick) auf die FritzBox übertragen.
</p>
<p>
Die Pfade dazu müssen in der prosody.cfg.lua entsprechend verändert werden:
</p>
<pre class="wiki">ssl = {
        key = "/var/media/ftp/uStor01/certs/localhost.key";
                certificate = "/var/media/ftp/uStor01/certs/localhost.crt";
                }

</pre><h3 id="InsInternetfreigeben">Ins Internet freigeben</h3>
<p>
Damit der Prosodyserver auch im Internet verfügbar ist, muss man nun noch die entsprechenden Ports auf die FritzBox weiterleiten. Dazu fügt  man in der <a class="wiki" href="avm-firewall.html">AVM-Firewall</a> die Einträge für den TCP-Port 5222 (für client-zu-server) und 5269 (server-zu-server) auf die IP der entsprechenden FritzBox (meist 0.0.0.0) hinzu.
</p>
<h3 id="Benutzerhinzufügen">Benutzer hinzufügen</h3>
<p>
Das Hinzufügen von Benutzern ist standardmäßig aus Sicherheitsgründen deaktiviert. Dies kann man in der prosody.lua.cfg temporär ändern, indem man false bei Allow registration auf true setzt. Danach kann man sich mit einem XMPP-Client registrieren.
</p>
<p>
Alternativ kann man mit der Shell Benutzer erstellen:
</p>
<pre class="wiki">prosodyctl adduser [Benutzer]@[Domain]
</pre><h3 id="POSIXaktivieren">POSIX aktivieren</h3>
<p>
Damit man prosody als Hintergrundprozess ausführen kann und damit man logging aktivieren kann, muss POSIX aktiviert werden.
</p>
<p>
Zunächst aktiviert man das Modul in der prosody.cfg.lua:
</p>
<pre class="wiki">   modules_enabled = {
        -- andere Module
        "posix"; -- mod_posix aktivieren
    }
</pre><p>
Zusätzlich wird noch ein pid-File benötigt, dazu fügen wir in der prosody.cfg.lua an:
</p>
<pre class="wiki">pidfile = "/var/tmp/flash/mod/prosody.pid"
</pre><h3 id="Datenexternspeichern">Daten extern speichern</h3>
<p>
Damit die Benutzerdateien nicht auf der FritzBox sondern auf einem externen Medium gespeichert werden, erstellt man eine symbolische Verlinkung:
</p>
<pre class="wiki">ln -s /var/media/ftp/uStor01/prosody/data /var/tmp/flash/mod/prosody/
</pre><h3 id="Benutzerhinzufügen1">Benutzer hinzufügen</h3>
<p>
Damit prosody nicht mit root-Rechten geöffnet werden muss, wird ein anderer Benutzer benötigt. Diesen kann man mithilfe der Shell erstellen:
</p>
<pre class="wiki">addgroup prosody
adduser -G prosody prosody
chown -R prosody:prosody /var/mod/home/prosody
</pre><h3 id="BeiSystemstartausführen">Bei Systemstart ausführen</h3>
<p>
Wenn man die Daten <span class="underline">nicht</span> extern speichert, reicht es, wenn mit vi /tmp/flash/mod/rc.custom folgendes hinzufügt:
</p>
<pre class="wiki">prosodyctl start
</pre><p>
Wenn man die Daten extern speichert, sollte man in das Verzeichnis /var/tmp/flash/mod wechseln und dort die folgenden Dateien anlegen:
</p>
<pre class="wiki">root@fritz:/var/tmp/flash/mod# vi rc.prosody
#!/bin/sh

start() {
        /usr/bin/prosodyctl start
}

stop() {
        /usr/bin/prosodyctl stop
}

case $1 in
        ""|start)
                start
                ;;
        stop)
                stop
                ;;
        *)
                echo "Usage: $0 [start|stop]" 1&gt;&amp;2
                exit 1
                ;;
esac

exit 0
</pre><pre class="wiki">root@fritz:/var/tmp/flash/mod# vi rc.external
#!/bin/sh
case $1 in
        load)
                ;;
        unload)
                sh /etc/init.d/rc.ngircd stop
                sh /etc/init.d/rc.prosody stop
                ;;
esac

eventadd 1 "Running custom rc.external done."

</pre><pre class="wiki">root@fritz:/var/tmp/flash/mod# vi /var/tmp/flash/onlinechanged-cgi
case "$1" in
 start)
   # Kommandos beim Start des Routers
   # ggf. sollten hier die Entraege von online) stehen
   ;;
 online)
   # Kommandos wenn der Router online geht (zB Zwangstrennung)
   #
      sleep 2;
      /var/tmp/flash/mod/rc.prosody start;
   ;;
 offline)
   # Kommandos wenn der Router offline geht (zB Zwangstrennung)
     /var/tmp/flash/mod/rc.prosody stop;
     sleep 2;
   ;;
esac
</pre><h3 id="Änderungenspeichern">Änderungen speichern</h3>
<p>
<img src="../../chrome/wikiextras-icons-16/exclamation.png" style="vertical-align: text-bottom" alt="/!\" /> Damit  diese Änderung beim Neustart erhalten bleibt müssen diese gespeichert werden:
</p>
<pre class="wiki">modsave all
</pre><h2 id="Prosodyausführen">Prosody ausführen</h2>
<p>
Prosody kann auch manuell gestartet werden mit:
</p>
<pre class="wiki">prosodyctl start
</pre><h2 id="Links">Links</h2>
<ul><li><a class="ext-link" href="http://prosody.im/"><span class="icon">​</span>Prosody IM homepage</a>
</li><li><a class="ext-link" href="http://trac.freetz.org/ticket/858"><span class="icon">​</span>Ticket with patches</a>
</li><li><a class="ext-link" href="http://www.lua.org/"><span class="icon">​</span>Lua homepage</a>
</li><li><a class="wiki" href="lua.html">Lua package</a>
</li><li><a class="ext-link" href="http://en.wikipedia.org/wiki/Extensible_Messaging_and_Presence_Protocol"><span class="icon">​</span>Wikipedia: XMPP</a> (Jabber)
</li><li><a class="ext-link" href="http://open-wrt.ru/forum/viewtopic.php?id=21643"><span class="icon">​</span>OpenWrt thread</a>
</li></ul></div>
          
          <div class="trac-modifiedby">
            <span><a href="prosody%3Faction=diff&amp;version=11.html" title="Version 11 von Spalanzani">zuletzt geändert</a> <a class="timeline" href="/timeline?from=2011-08-19T21%3A54%3A08Z&amp;precision=second" title="Siehe Journal am 19.08.2011 21:54:08">vor 7 Jahren</a></span>
            <span class="trac-print">Zuletzt geändert am 19.08.2011 21:54:08</span>
          </div>
        
        
      </div>
      

    </div>
    <div id="altlinks">
      <h3>In anderen Formaten herunterladen:</h3>
      <ul>
        <li class="last first">
          <a rel="nofollow" href="prosody%3Fformat=txt">Reiner Text</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Betrieben mit <a href="/about"><strong>Trac 1.0.1</strong></a><br />
        von <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right"><div class="field" align="right"><form action="https://www.paypal.com/cgi-bin/webscr" method="post"><input type="hidden" name="cmd" value="_donations"/><input type="hidden" name="business" value="spenden@freetz.org"/><input type="hidden" name="item_name" value="Freetz Entwickler-Team"/><input type="hidden" name="no_shipping" value="1"/><input type="hidden" name="return" value="http://freetz.org"/><input type="hidden" name="cn" value="Name oder IPPF-Pseudonym"/><input type="hidden" name="currency_code" value="EUR"/><input type="hidden" name="tax" value="0"/><input type="hidden" name="lc" value="DE"/><input type="hidden" name="bn" value="PP-DonationsBF"/><input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="Zahlen Sie mit PayPal - schnell, kostenlos und sicher!"/><img alt="" border="0" src="/pixel.gif" width="1" height="1"/></form></div></p>
    </div>
  </body>
</html>