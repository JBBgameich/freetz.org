<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  


  <head>
    <title>
      help/howtos/security/router_and_firewall – Freetz
    </title>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="/search" />
        <link rel="help" href="../../../TracGuide.html" />
        <link rel="alternate" href="router_and_firewall%3Fformat=txt" type="text/x-trac-wiki" title="Reiner Text" />
        <link rel="up" href="../security.html" title="Übergeordnete Wiki-Seite anzeigen" />
        <link rel="start" href="/wiki" />
        <link rel="stylesheet" href="../../../../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../../../../chrome/common/css/wiki.css" type="text/css" /><link rel="stylesheet" href="../../../../chrome/wikiextras/css/phrases.css" type="text/css" /><link rel="stylesheet" href="../../../../chrome/wikiextras/css/boxes.css" type="text/css" /><link rel="stylesheet" href="../../../../chrome/wikiextras/css/boxes-300.css" type="text/css" /><link rel="stylesheet" href="../../../../chrome/wikiextras/css/boxes-narrow-toc.css" type="text/css" /><link rel="stylesheet" href="../../../../wikicss.css" type="text/css" /><link rel="stylesheet" href="../../../../chrome/tags/css/tractags.css" type="text/css" /><link rel="stylesheet" href="../../../../chrome/wikinegotiator/css/langmenu-ctxnav.css" type="text/css" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="/favicon.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="/search/opensearch" title="Freetz durchsuchen" />
      <script type="text/javascript" charset="utf-8" src="../../../../chrome/common/js/jquery.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../chrome/common/js/babel.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../chrome/common/js/messages/de.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../chrome/common/js/trac.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../chrome/common/js/search.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../chrome/common/js/folding.js"></script>
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("#content").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $("#content").find(".wikianchor").each(function() {
          $(this).addAnchor(babel.format(_("Link to #%(id)s"), {id: $(this).attr('id')}));
        });
        $(".foldable").enableFolding(true, true);
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="/wiki"><img src="../../../../chrome/common/freetz_motd.png" alt="Freetz" /></a>
      </div>
      <form id="search" action="/search" method="get">
        <div>
          <label for="proj-search">Suche:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Suche" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="/login">Anmelden</a></li><li><a href="/prefs">Einstellungen</a></li><li><a href="../../../TracGuide.html">Hilfe/Anleitung</a></li><li><a href="/about">Über Trac</a></li><li><a href="/notification" title="Wiki Pages Change Notifications">My Notifications</a></li><li><a href="/register">Registrieren</a></li><li class="last"><a href="../../../Impressum.html">Impressum</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="/wiki">Wiki</a></li><li><a href="/timeline">Journal</a></li><li><a href="/roadmap">Projektplan</a></li><li><a href="/browser">Quellen durchsehen</a></li><li><a href="/report">Tickets anzeigen</a></li><li><a href="/search">Suche</a></li><li><a href="/tags">Tags</a></li><li><a href="/downloads">Downloads</a></li><li class="last"><a href="/screenshots">Bildschirmfotos</a></li>
    </ul>
  </div>
    <div id="langmenu"><ul><li class="first"><span title="Select a language of wiki content">Language:</span></li><li class=" active"><a class="" href="router_and_firewall..html" title="displaying language (default)">German</a></li><li class=" last"><a class=" notexist" href="/wiki/help/howtos/security/router_and_firewall.en" title="(not available)">English</a></li></ul></div><div id="main">
      <div id="pagepath" class="noprint">
  <a class="pathentry first" title="Zeige WikiStart an" href="/wiki">Wiki:</a><a class="pathentry" href="../../../help.html" title="Zeige help an">help</a><span class="pathentry sep">/</span><a class="pathentry" href="../../howtos.html" title="Zeige help/howtos an">howtos</a><span class="pathentry sep">/</span><a class="pathentry" href="../security.html" title="Zeige help/howtos/security an">security</a><span class="pathentry sep">/</span><a class="pathentry" href="router_and_firewall.html" title="Zeige help/howtos/security/router_and_firewall an">router_and_firewall</a>
</div>
      <div id="ctxtnav" class="nav">
        <h2>Kontext-Navigation</h2>
        <ul>
          <li class="first"><a href="../security.html">Aufwärts</a></li><li><a href="../../../WikiStart.html">Startseite</a></li><li><a href="../../../TitleIndex.html">Inhaltsverzeichnis</a></li><li><a href="router_and_firewall%3Faction=history.html">Änderungshistorie</a></li><li class="last"><a href="/notification/help/howtos/security/router_and_firewall" title="Watch Page">Watch Page</a></li>
        </ul>
        <hr />
      </div>
    <div id="content" class="wiki">
      <div class="wikipage searchable">
        
          <div id="wikipage" class="trac-content"><p>
</p><div class="wiki-toc"><h4>Inhaltsverzeichnis</h4><ol><li><a href="switch_config.html#KonfigurationdeseingebautenSwitches">Konfiguration des eingebauten Switches</a><ol><li><a href="switch_config.html#Vorwort">Vorwort</a></li><li><a href="switch_config.html#VordefinierteSwitch-Konfigurationen">Vordefinierte Switch-Konfigurationen</a></li><li><a href="switch_config.html#Anpassungeninderar7.cfg">Anpassungen in der ar7.cfg</a></li><li><a href="switch_config.html#Beispiel">Beispiel</a></li><li><a href="switch_config.html#Sicherheits-Warnung">Sicherheits-Warnung</a></li><li><a href="switch_config.html#Kompatibilität">Kompatibilität</a></li></ol></li><li><a href="user_management.html#Benutzerverwaltung">Benutzerverwaltung</a><ol><li><a href="user_management.html#Benutzeranlegen">Benutzer anlegen</a></li><li><a href="user_management.html#Benutzerlöschen">Benutzer löschen</a></li><li><a href="user_management.html#ManuelleAnpassungen">Manuelle Anpassungen</a></li><li><a href="user_management.html#Besonderheiten">Besonderheiten</a></li></ol></li><li><a href="split_wlan_lan.html#WLANvonLANtrennenmitiptables">WLAN von LAN trennen mit iptables</a><ol><li><a href="split_wlan_lan.html#FRITZBoxEinstellung">FRITZBox Einstellung</a></li><li><a href="split_wlan_lan.html#iptables">iptables</a></li></ol></li><li class="active"><a href="router_and_firewall.html#FreetzalsinternerRoutermitFirewall">Freetz als interner Router mit Firewall</a><ol><li class="active"><a href="router_and_firewall.html#Zielgruppe">Zielgruppe</a></li><li class="active"><a href="router_and_firewall.html#Beispielszenario">Beispielszenario</a></li><li class="active"><a href="router_and_firewall.html#DieFritzboxmodden">Die Fritzbox modden</a></li><li class="active"><a href="router_and_firewall.html#DieFritzboxaufgetrennteNetzeumstellen">Die Fritzbox auf getrennte Netze umstellen</a></li><li class="active"><a href="router_and_firewall.html#ErstellenderRouten">Erstellen der Routen</a></li><li class="active"><a href="router_and_firewall.html#DieRückrouten">Die Rückrouten</a></li><li class="active"><a href="router_and_firewall.html#Firewall">Firewall</a></li><li class="active"><a href="router_and_firewall.html#FIXMEkopierterPost">FIXME kopierter Post</a></li></ol></li></ol></div><p>
</p>
<h1 id="FreetzalsinternerRoutermitFirewall">Freetz als interner Router mit Firewall</h1>
<p>
Diese Anleitung enthält alles was man braucht, um eine FritzBox 7050 mit freetz in einen internen Router mit Firewall und echter DMZ zu verwandeln.<br />
Andere Router funktionieren auch, so lange sie mit Linux laufen, iptables und 2 getrennt ansprechbare Netzwerkschnittstellen haben. Geräte mit einen Switch, der nur komplett als <strong>ein Interface</strong> angesprochen werden kann, können keine LAN DMZ (<strong>D</strong>e<strong>M</strong>ilitarized <strong>Z</strong>one) errstellen. Das WLAN läßt sich aber bei allen Routern, abtrennen.
</p>
<h2 id="Zielgruppe">Zielgruppe</h2>
<p>
Ambitionierte Heimanwender und kleinere bis mittlere Betriebe die ein extra gesichertes WLAN und/oder Zweitnetzwerk benötigen.
</p>
<h2 id="Beispielszenario">Beispielszenario</h2>
<ul><li>Internes Netz1: 192.168.178.0/255.255.255.0 (Anwendernetz)
</li><li>Internes Netz2: 192.168.181.0/255.255.255.0 (Servernetz, echte DMZ)
</li><li>WLAN: 192.168.181.0/255.255.255.0
</li><li>Internetrouter: 192.168.178.1  z.B. weitere Fritzbox, die sich im internen Netz befindet und gleichzeitig als DNS Server fungiert.
</li></ul><p>
Wir wollen allen Benutzern des internen Netzes 1 Zugriff auf das gesammte Netz2 ermöglichen, die WLAN Benutzer sollen aber nur auf das Internet und bestimmte Dienste in der DMZ zugreifen können. Als Beispiel nehmen wir einen Webserver, einen Mailserver und einen FTP-Server mit folgenden Daten:
</p>
<ul><li>Webserver: IP 192.168.181.5, Ports 80,443
</li><li>Mailserver: IP 192.168.181.6, Ports 25,143,110,993,995
</li><li>FTP-Server: IP 192.168.181.7, Port 21,(20) FTP braucht noch einen zusätzlichen Port für den Rückkanal, je nach Modus (aktiv/passiv)
</li></ul><h2 id="DieFritzboxmodden">Die Fritzbox modden</h2>
<p>
FIXME
</p>
<h2 id="DieFritzboxaufgetrennteNetzeumstellen">Die Fritzbox auf getrennte Netze umstellen</h2>
<p>
Unter <em>Einstellungen &rarr; System &rarr; Netzwerkeinstullungen &rarr; »IP-Adressen«</em> deaktivieren wir nun <em>Alle Computer befinden sich im selben IP-Netzwerk</em>. Damit hat jetzt jedes Interface LAN-A,LAN-B,WLAN,USB sein eigenes Netz:
</p>
<p>
<span class="thumbnail"><span class="aux" style="width: 602px;"><a style="border-width: 1px;" href="/screenshots/48?format=raw" title="Einstellungen für separate Netzwerke (Fritz!Box 7050)"><img src="/screenshots/48?width=600&amp;format=raw&amp;height=572" alt="Einstellungen für separate Netzwerke (Fritz!Box 7050)" /></a><span class="description" style="width: 602px;">Einstellungen für separate Netzwerke (FritzBox 7050)</span></span></span>
</p>
<h2 id="ErstellenderRouten">Erstellen der Routen</h2>
<p>
FIXME
</p>
<h2 id="DieRückrouten">Die Rückrouten</h2>
<p>
Im Moment können wir zwar Pakete aus unseren DMZ/WLAN ins Internet verschicken und Pakete von der DMZ ins interne Netz (wird später durch die Firewall eingeschränkt). Aber unser Internetrouter, der auch Default Router für alle Rechner ist, kennt unsere neuen Netze noch nicht und verwirft damit alle Antwortpakete.
</p>
<p>
Auf Arbeitsrechner marvin (192.168.178.2):
</p>
<div class="code"><pre>jr@marvin<span class="nv">$ </span>ping -c 4 192.168.181.1
PING 192.168.181.1 <span class="o">(</span>192.168.181.1<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.

--- 192.168.181.1 ping statistics ---
4 packets transmitted, 0 received, 100% packet loss, <span class="nb">time </span>2999ms
</pre></div><p>
Wir müssen also noch die Rückrouten auf unserem <strong>Internetrouter</strong> einrichten.
</p>
<p>
Beispiel Linux Router:
</p>
<div class="code"><pre>route add -net 192.168.181.0 netmask 255.255.255.0 gw 192.168.178.14
route add -net 192.168.182.0 netmask 255.255.255.0 gw 192.168.178.14
route add -net 192.168.179.0 netmask 255.255.255.0 gw 192.168.178.14
</pre></div><p>
Beispiel Fritzbox:
</p>
<p>
Unter <em>Einstellungen &rarr; System &rarr; Netzwerkeinstellungen &rarr; »IP-Routen«</em> wählen wir <em>»Neue Route«</em>:
</p>
<p>
<span class="thumbnail"><span class="aux" style="width: 602px;"><a style="border-width: 1px;" href="/screenshots/49?format=raw" title="Fritzbox: Route hinzufügen"><img src="/screenshots/49?width=600&amp;format=raw&amp;height=450" alt="Fritzbox: Route hinzufügen" /></a><span class="description" style="width: 602px;">Route hinzufügen Dialog</span></span></span>
</p>
<pre class="wiki">Aktiv  	Netzwerk  	Subnetzmaske  	Gateway  	   	 
X	192.168.181.0 	255.255.255.0 	192.168.178.14 #LANB
X	192.168.182.0 	255.255.255.0 	192.168.178.14 #WLAN
X	192.168.179.0 	255.255.255.0 	192.168.178.14 #USB
</pre><p>
Jetzt kommen die Pakete auch wieder zurück. Interessant ist hier die Redirect-Meldung des Standardgateways, das jetzt den Rechner an unserer internes Fritzbox verweist.
</p>
<div class="code"><pre>jr@marvin<span class="nv">$ </span>ping 192.168.181.1
PING 192.168.181.1 <span class="o">(</span>192.168.181.1<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
From 192.168.178.1: <span class="nv">icmp_seq</span><span class="o">=</span>1 Redirect Host<span class="o">(</span>New nexthop: 192.168.178.14<span class="o">)</span>
64 bytes from 192.168.181.1: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>2.43 ms
From 192.168.178.1: <span class="nv">icmp_seq</span><span class="o">=</span>2 Redirect Host<span class="o">(</span>New nexthop: 192.168.178.14<span class="o">)</span>
64 bytes from 192.168.181.1: <span class="nv">icmp_seq</span><span class="o">=</span>2 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>2.43 ms
64 bytes from 192.168.181.1: <span class="nv">icmp_seq</span><span class="o">=</span>3 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.519 ms
64 bytes from 192.168.181.1: <span class="nv">icmp_seq</span><span class="o">=</span>4 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.521 ms
64 bytes from 192.168.181.1: <span class="nv">icmp_seq</span><span class="o">=</span>5 <span class="nv">ttl</span><span class="o">=</span>64 <span class="nb">time</span><span class="o">=</span>0.523 ms
</pre></div><h2 id="Firewall">Firewall</h2>
<p>
FIXME
</p>
<h2 id="FIXMEkopierterPost">FIXME kopierter Post</h2>
<p>
<a class="ext-link" href="http://www.ip-phone-forum.de/showpost.php?p=1096655&amp;postcount=22"><span class="icon">​</span>orginalpost</a>
</p>
<blockquote>
<p>
Nachdem was ich gelesen habe brauchst du einen Router mit Firewall. Iptables ist die standard Linuxfirewall seit Kernel 2.4, avm hat sich aber da was eigenes gestrickt. Als Router kannst du alles nehmen auf dem a) Linux läuft b) eine echte Firewall läuft und c) du die Firewallregeln veränderen kannst.
Damit kannst du also eine <strong>fritzbox mit telnet bzw. ssh Zugang benutzen (avm firewall)</strong>, eine mit freetz gemoddedte fritzbox(iptables) oder einen Linuxrechner(iptables) verwenden.
Edit2: Nachdem ich noch etwas getestet habe, habe ich jetzt festgestellt, das die avm firewall wohl nur mit dem DSL Interface funktioniert. Wir brauchen also iptables.
</p>
</blockquote>
<blockquote>
<p>
Den Linuxrechner halte ich für overkill, da du ja eh eine Fritzbox fürs WLAN nehmen willst.
Damit du dein eigenes Netz nicht unnötig umbauen mußt würde ich eine der 7050er Fritzboxen nehmen und mit Port A in dein Netz hängen. 
</p>
</blockquote>
<blockquote>
<p>
Ich versuche mal eine Anleitung: (EDIT: irgendwas geht noch nicht richtig, siehe unten)
Alles ab hier wird jetzt nur noch auf der 7050 für den Nachbar gemacht:
</p>
</blockquote>
<ol><li>Die Box braucht erstmal eine interne(=dein Netz) IP, damit du drauf  zugreifen kannst.
1.Danach bekommt jeder Anschluß ein eigenes Netz (siehe Bild1):<br />Webinterface&rarr;Einstellungen&rarr;System&rarr;Netzwerkeinstellungen: Alle Computer befinden sich im selben IP-Netzwerk abschalten. Jetzt hat jeder Anschluß ein eigenes Netz.<br />Wichtig hierbei ist, dass der DHCP Server für das interne Netz aus ist, sonst hast 2 DHCP Server, die sich gegenseitig stören.
</li><li>Die Internetverbindung wird jetzt auf Port A gestellt (siehe Bild2)<br />Der Witz bei der Sache ist, das man DSL Verbindung anwählt und nicht Port A, denn dann hat man nicht mehr die verschiedenen Netze.
</li><li>route hinzufügen:
<pre class="wiki">Aktiv  	Netzwerk  	Subnetzmaske  	Gateway  	   	 
X	0.0.0.0 	0.0.0.0 	192.168.178.1
</pre>4a) routen <strong>auf der Internet Fritzbox</strong> hinzufügen
<pre class="wiki">Aktiv  	Netzwerk  	Subnetzmaske  	Gateway  	   	 
X	192.168.181.0 	255.255.255.0 	192.168.178.14 #LANB
X	192.168.182.0 	255.255.255.0 	192.168.178.14 #WLAN
X	192.168.179.0 	255.255.255.0 	192.168.178.14 #USB
</pre></li><li>Telnet aktivieren<br />Gibt es genug Anleitungen im Forum. Bei den neueren Firmwares sollte ein telnet pseudo-Image funktionieren
</li><li>firewall<br />Im Moment
Edit:
<em>So weit hab ich das jetzt mal bei mir getestet und ich kann die Box erreichen, DNS geht, auch aus den anderen Netzen. [color=blue]Das einzige, was jetzt hier noch Probleme macht ist das Routing zwischen den Netzen und damit auch ins Internet. Irgendwas blockiert das Routing, mit den Einstellungen funktioniert es auf einem Linux Rechner (forward ist an)! Vieleicht weiß jemand anderes weiter.<a href="/color">color</a></em> Ich hatte einfach die Rückroute auf der 2. Fritzbox fürs Internet vergessen(siehe 4a)!
</li></ol></div>
          
          <div class="trac-modifiedby">
            <span><a href="router_and_firewall%3Faction=diff&amp;version=3.html" title="Version 3 von joha">zuletzt geändert</a> <a class="timeline" href="/timeline?from=2008-10-02T13%3A07%3A23Z&amp;precision=second" title="Siehe Journal am 02.10.2008 13:07:23">vor 10 Jahren</a></span>
            <span class="trac-print">Zuletzt geändert am 02.10.2008 13:07:23</span>
          </div>
        
        
      </div><ul class="tags"><li class="header">Tags</li><li><a href="/tags/firewall" rel="tag">firewall</a> </li><li><a href="/tags/howtos" rel="tag">howtos</a> </li></ul>
      

    </div>
    <script type="text/javascript">
        jQuery.loadStyleSheet("/chrome/screenshots/css/screenshots.css", "text/css");
        jQuery.loadStyleSheet("/pygments/trac.css", "text/css");
    </script>
    <div id="altlinks">
      <h3>In anderen Formaten herunterladen:</h3>
      <ul>
        <li class="last first">
          <a rel="nofollow" href="router_and_firewall%3Fformat=txt">Reiner Text</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../../../../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Betrieben mit <a href="/about"><strong>Trac 1.0.1</strong></a><br />
        von <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right"><div class="field" align="right"><form action="https://www.paypal.com/cgi-bin/webscr" method="post"><input type="hidden" name="cmd" value="_donations"/><input type="hidden" name="business" value="spenden@freetz.org"/><input type="hidden" name="item_name" value="Freetz Entwickler-Team"/><input type="hidden" name="no_shipping" value="1"/><input type="hidden" name="return" value="http://freetz.org"/><input type="hidden" name="cn" value="Name oder IPPF-Pseudonym"/><input type="hidden" name="currency_code" value="EUR"/><input type="hidden" name="tax" value="0"/><input type="hidden" name="lc" value="DE"/><input type="hidden" name="bn" value="PP-DonationsBF"/><input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="Zahlen Sie mit PayPal - schnell, kostenlos und sicher!"/><img alt="" border="0" src="/pixel.gif" width="1" height="1"/></form></div></p>
    </div>
  </body>
</html>