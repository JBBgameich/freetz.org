<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  


  <head>
    <title>
      help/howtos/development/developer_information/package_development_start/example_1 – Freetz
    </title>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="/search" />
        <link rel="help" href="../../../../../TracGuide.html" />
        <link rel="alternate" href="example_1%3Fformat=txt" type="text/x-trac-wiki" title="Reiner Text" />
        <link rel="up" href="../package_development_start.html" title="Übergeordnete Wiki-Seite anzeigen" />
        <link rel="start" href="/wiki" />
        <link rel="stylesheet" href="../../../../../../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../../../../../../chrome/common/css/wiki.css" type="text/css" /><link rel="stylesheet" href="../../../../../../chrome/wikiextras/css/phrases.css" type="text/css" /><link rel="stylesheet" href="../../../../../../chrome/wikiextras/css/boxes.css" type="text/css" /><link rel="stylesheet" href="../../../../../../chrome/wikiextras/css/boxes-300.css" type="text/css" /><link rel="stylesheet" href="../../../../../../chrome/wikiextras/css/boxes-narrow-toc.css" type="text/css" /><link rel="stylesheet" href="../../../../../../wikicss.css" type="text/css" /><link rel="stylesheet" href="../../../../../../chrome/tags/css/tractags.css" type="text/css" /><link rel="stylesheet" href="../../../../../../chrome/wikinegotiator/css/langmenu-ctxnav.css" type="text/css" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="/favicon.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="/search/opensearch" title="Freetz durchsuchen" />
      <script type="text/javascript" charset="utf-8" src="../../../../../../chrome/common/js/jquery.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../../../chrome/common/js/babel.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../../../chrome/common/js/messages/de.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../../../chrome/common/js/trac.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../../../chrome/common/js/search.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../../../chrome/common/js/folding.js"></script>
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("#content").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $("#content").find(".wikianchor").each(function() {
          $(this).addAnchor(babel.format(_("Link to #%(id)s"), {id: $(this).attr('id')}));
        });
        $(".foldable").enableFolding(true, true);
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="/wiki"><img src="../../../../../../chrome/common/freetz_motd.png" alt="Freetz" /></a>
      </div>
      <form id="search" action="/search" method="get">
        <div>
          <label for="proj-search">Suche:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Suche" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="/login">Anmelden</a></li><li><a href="/prefs">Einstellungen</a></li><li><a href="../../../../../TracGuide.html">Hilfe/Anleitung</a></li><li><a href="/about">Über Trac</a></li><li><a href="/notification" title="Wiki Pages Change Notifications">My Notifications</a></li><li><a href="/register">Registrieren</a></li><li class="last"><a href="../../../../../Impressum.html">Impressum</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="/wiki">Wiki</a></li><li><a href="/timeline">Journal</a></li><li><a href="/roadmap">Projektplan</a></li><li><a href="/browser">Quellen durchsehen</a></li><li><a href="/report">Tickets anzeigen</a></li><li><a href="/search">Suche</a></li><li><a href="/tags">Tags</a></li><li><a href="/downloads">Downloads</a></li><li class="last"><a href="/screenshots">Bildschirmfotos</a></li>
    </ul>
  </div>
    <div id="langmenu"><ul><li class="first"><span title="Select a language of wiki content">Language:</span></li><li class=" active"><a class="" href="example_1..html" title="displaying language (default)">German</a></li><li class=" last"><a class=" notexist" href="/wiki/help/howtos/development/developer_information/package_development_start/example_1.en" title="(not available)">English</a></li></ul></div><div id="main">
      <div id="pagepath" class="noprint">
  <a class="pathentry first" title="Zeige WikiStart an" href="/wiki">Wiki:</a><a class="pathentry" href="../../../../../help.html" title="Zeige help an">help</a><span class="pathentry sep">/</span><a class="pathentry" href="../../../../howtos.html" title="Zeige help/howtos an">howtos</a><span class="pathentry sep">/</span><a class="pathentry" href="../../../development.html" title="Zeige help/howtos/development an">development</a><span class="pathentry sep">/</span><a class="pathentry" href="../../developer_information.html" title="Zeige help/howtos/development/developer_information an">developer_information</a><span class="pathentry sep">/</span><a class="pathentry" href="../package_development_start.html" title="Zeige help/howtos/development/developer_information/package_development_start an">package_development_start</a><span class="pathentry sep">/</span><a class="pathentry" href="example_1.html" title="Zeige help/howtos/development/developer_information/package_development_start/example_1 an">example_1</a>
</div>
      <div id="ctxtnav" class="nav">
        <h2>Kontext-Navigation</h2>
        <ul>
          <li class="first"><a href="../package_development_start.html">Aufwärts</a></li><li><a href="../../../../../WikiStart.html">Startseite</a></li><li><a href="../../../../../TitleIndex.html">Inhaltsverzeichnis</a></li><li><a href="example_1%3Faction=history.html">Änderungshistorie</a></li><li class="last"><a href="/notification/help/howtos/development/developer_information/package_development_start/example_1." title="Watch Page">Watch Page</a></li>
        </ul>
        <hr />
      </div>
    <div id="content" class="wiki">
      <div class="wikipage searchable">
        
          <div id="wikipage" class="trac-content"><h1 id="Example1:Httptunnel">Example 1: Httptunnel</h1>
<p>
This first example if for the <a class="ext-link" href="http://www.nocrew.org/software/httptunnel.html"><span class="icon">​</span>HTTP tunnel server</a> package.<br />
</p>
<p>
With <em><a class="wiki" href="../../../../../packages/httptunnel.html">httptunnel</a></em> you can tunnel TCP connections over the http protocol and thus get access to your box even through restrictive proxies, e.g. such proxies where only ports 80 (http) and 443 (https) are open. More details can be read <a class="ext-link" href="http://linuxwiki.de/HttpTunnel"><span class="icon">​</span>here</a>.
</p>
<p>
<a class="ext-link" href="http://www.ip-phone-forum.de/showthread.php?t=167980"><span class="icon">​</span>This thread</a> in the IPPF is the right place where you can read about the evolution of this project, with a lot of really helpful hints from the gurus.
</p>
<h2 id="Buildmanually">Build manually</h2>
<p>
If you do not want to build it manually, but rather within the freetz build system, the following commands are not necessary.<br />
But executing the following steps will help a lot in understanding the steps for intergrading the package into Freetz.
</p>
<p>
In order to build your new package manually (without integration in the freetz build system), you should see that your toolchain is also included in the search path. This is achieved with the PATH= export command below.
</p>
<pre class="wiki">mkdir httptunnel
cd httptunnel
wget http://www.nocrew.org/software/httptunnel/httptunnel-3.0.5.tar.gz
tar xfz httptunnel-3.0.5.tar.gz
cd ~/freetz-trunk/httptunnel/httptunnel-3.0.5/
export CC="mipsel-linux-gcc"
export PATH=/home/freetz/freetz-trunk/toolchain/target/bin/:$PATH
./configure --build=i386-linux-gnu --target=mipsel-linux --host=mipsel-linux
make
file hts *
file htc *
mipsel-linux-strip hts htc
file hts *
file htc *
</pre><blockquote>
<p>
<sup>*</sup> Optional, to see the impact of stripping. The file command should also show the executable is a MIPS executable.
</p>
</blockquote>
<p>
A failure like <em>checking whether the C compiler (mipsel-linux-gcc -O2 -Wall -fomit-frame-pointer ) works&hellip; no</em><br /><em>configure: error: installation or configuration problem: C compiler cannot create executables.</em> most likely point to a wrong PATH environment setting. Use <tt>echo $PATH</tt> for trouble shooting.
</p>
<p>
Next you might want to see that "<tt>make clean</tt>" properly works for this package.
This will remove all generated files. <br />(For packages involving a .config file you might want to save that file to a save location, because make clean often will also delete this file. But this is not applicable for httptunnel.)
</p>
<pre class="wiki">cd ~/freetz-trunk/httptunnel/httptunnel-3.0.5/
make clean
</pre><p>
The Freetz environment makes use of "<tt>make clean</tt>" of each package to remove all generated files during compiling.<br />
So testing this with this manual created package should give an idea what happens giving a "<tt>make clean</tt>" within Freetz.
</p>
<h2 id="AddpackagetoFreetz">Add package to Freetz</h2>
<p>
In this first example we will use an existing package, and modify the files.
</p>
<h3 id="UseoftheemptyPackageasStartingPoint">Use of  the "empty" Package as Starting Point</h3>
<p>
Note: "empty" is the name of a real package, it is not just an starting point for a new package.
</p>
<p>
Because httptunnel is already integrated in Freetz the files are already present. Lets tar them in a file and remove them:
</p>
<pre class="wiki">cd ~/freetz-trunk/make/
tar cfz httptunnel_orig.tar.gz httptunnel/
ls -la httptunnel_orig.tar.gz
tar tfz httptunnel_orig.tar.gz
sudo rm -r httptunnel
</pre><p>
We also need to delete some auto generated files to make sure the changes are recognized (no need to save these, as they will be generated again):
</p>
<pre class="wiki">rm make/external.in.generated
rm make/Config.in.generated
</pre><p>
(sudo will execute the command with root rights, so be carefull.)
</p>
<p>
Go to <tt>~/freetz-trunk/make/empty</tt>. This package will serve as your starting point to build your own httptunnel package.<br />There are two files: <tt>Config.in</tt>, <tt>empty.mk</tt>, (and a directory "<tt>.svn</tt>").
</p>
<p>
For your http tunnel project you may copy the complete "empty" directory with the two files as a new package. Let us call it "httptunnel".<br />
</p>
<pre class="wiki">cp -r ~/freetz-trunk/make/empty ~/freetz-trunk/make/httptunnel
</pre><p>
Please go into that new "<tt>httptunnel</tt>" directory and remove the sub-directory "<tt>.svn</tt>". You will not need it. Now it should look like this:
</p>
<pre class="wiki">-rw-r--r--   1 slightly slightly  480 2008-06-07 08:17 Config.in
-rw-r--r--   1 slightly slightly  701 2008-06-07 08:17 empty.mk 
</pre><p>
Rename "<tt>empty.mk</tt>" to "<tt>httptunnel.mk</tt>", because this is what your project is about now: httptunnel. The base name of the file ("<tt>httptunnel</tt>") will be used to define the variables <tt>$(PKG)</tt> to <tt>HTTPTUNNEL</tt> and <tt>$(pkg)</tt> to <tt>httptunnel</tt> within the file "<tt>httptunnel.mk</tt>".
</p>
<p>
Now let us have a look at the "<tt>Config.in</tt>" file. Open it with your favorite editor, and it should look like this:
</p>
<pre class="wiki">config FREETZ_PACKAGE_EMPTY
        bool "Empty 0.6.15b"
        select FREETZ_LIB_libutil
        default n
        help
                empty is an utility that provides an interface to execute and/or
                interact with processes under pseudo-terminal sessions (PTYs).
                This tool is definitely useful in programming of shell scripts
                designed to communicate with interactive programs like telnet,
                ssh, ftp, etc. In some cases, empty can be the simplest
                replacement for TCL/expect or other similar programming tools.
</pre><p>
In this file you basically find the package name (bool) and a short help text.
</p>
<p>
You should change this to reflect your http tunnel project. Please note that the line "select FREETZ_LIB_libutil" is not necessary for your project, thus remove it:
</p>
<pre class="wiki">config FREETZ_PACKAGE_HTTPTUNNEL
        bool "httptunnel 3.0.5 (binary only)"
        default n
        help
                httptunnel is a utility that provides a HTTP tunnel server on your box.
</pre><blockquote>
<p>
(the indents should be tab's not spaces)
</p>
</blockquote>
<p>
The next file "<tt>httptunnel.mk</tt>" (copied from "<tt>empty.mk</tt>") should be edited like this:
</p>
<pre class="wiki">$(call PKG_INIT_BIN, 3.0.5)
$(PKG)_SOURCE:=$(pkg)-$($(PKG)_VERSION).tar.gz
$(PKG)_SITE:=http://www.nocrew.org/software/httptunnel
$(PKG)_BINARY:=$($(PKG)_DIR)/hts
$(PKG)_TARGET_BINARY:=$($(PKG)_DEST_DIR)/usr/bin/hts
$(PKG)_CATEGORY:=Unstable

$(PKG_SOURCE_DOWNLOAD)
$(PKG_UNPACKED)
$(PKG_CONFIGURED_CONFIGURE)

$($(PKG)_BINARY): $($(PKG)_DIR)/.configured
        $(SUBMAKE) -C $(HTTPTUNNEL_DIR) \
                CC="$(TARGET_CC)" \
                CFLAGS="$(TARGET_CFLAGS)"

$($(PKG)_TARGET_BINARY): $($(PKG)_BINARY)
        $(INSTALL_BINARY_STRIP)

$(pkg):

$(pkg)-precompiled: $($(PKG)_TARGET_BINARY)

$(pkg)-clean:
        -$(MAKE) -C $(HTTPTUNNEL_DIR) clean

$(pkg)-uninstall:
        $(RM) $(HTTPTUNNEL_TARGET_BINARY)

$(PKG_FINISH)
</pre><p>
Explanation:
</p>
<pre class="wiki">$(call PKG_INIT_BIN, 3.0.5)
</pre><p>
This defines the version of your package.
<br /><br />
</p>
<pre class="wiki">$(PKG)_SOURCE:=httptunnel-$($(PKG)_VERSION).tar.gz
</pre><p>
This defines the file name of the package source code, which has to be exactly as the filename on the server where the file is located.
<br /><br />
</p>
<pre class="wiki">$(PKG)_SITE:=http://www.nocrew.org/software/httptunnel
</pre><p>
This defines the basis of the download URL from where the package source code will be downloaded during the build process.<br />In this case, the complete path would be: <a class="ext-link" href="http://www.nocrew.org/software/httptunnel/httptunnel-3.0.5.tar.gz"><span class="icon">​</span>http://www.nocrew.org/software/httptunnel/httptunnel-3.0.5.tar.gz</a>
<br /><br />
</p>
<pre class="wiki">$(PKG)_BINARY:=$($(PKG)_DIR)/hts
</pre><p>
This defines the file name of the binary in the source directory.
<br /><br />
</p>
<pre class="wiki">$(PKG)_TARGET_BINARY:=$($(PKG)_DEST_DIR)/usr/bin/hts
</pre><p>
This defines the path of the binary of your package where it will be stored on your box when your new package and FW is installed on your box.
<br /><br />
</p>
<pre class="wiki">$(PKG)_CATEGORY:=Unstable
</pre><p>
This causes the package to be listed under the list of unstable packages in the menu. <br />
If a package if found stable this line can be removed, so it becomes listed under the normal packages.
<br /><br />
</p>
<pre class="wiki">$(PKG_CONFIGURED_CONFIGURE)
</pre><p>
This assumes that the program is configured by calling the GNU "<tt>configure</tt>", which is true for most programs. For some programs "<tt>configure</tt>" will fail to find out settings because it is cross compiling and can't run a test program. In this case, look at the "<tt>configure</tt>" around the line numbers given in th error message. You will find tests and assignments to variables like ac_cv_func_setvbuf_reversed. Find the correct value and add a line like this to "<tt>httptunnel.mk</tt>"
<br /><br />
</p>
<pre class="wiki">$(PKG)_CONFIGURE_ENV += ac_cv_func_setvbuf_reversed=no
</pre><p>
You may need to set $(PKG)_DEPENDS_ON if your package depends on other packages (e.g. see example 3). List the names of corresponding .mk files with all plus-signs replaced by x's  and all minus-signs replaced by underscores and separate package names by spaces.
<br /><br />
</p>
<pre class="wiki">$(SUBMAKE) -C $(HTTPTUNNEL_DIR)
</pre><p>
This calls the package's Makefile with the Freetz environment set (e.g. FREETZ_LD_RUN_PATH)
</p>
<p>
Now we also need to make sure that the following is changed, because "configure" needs to be called for this package to be built:
</p>
<p>
Go back to file "httptunnel.mk" and edit the line PKG_CONFIGURED_NOP to PKG_CONFIGURED_CONFIGURE:
</p>
<pre class="wiki">$(PKG_SOURCE_DOWNLOAD)
$(PKG_UNPACKED)
$(PKG_CONFIGURED_CONFIGURE)
</pre><p>
If you left it as PKG_CONFIGURED_NOP, this would mean that "configure" was not necessary to be called. However, with this package you will need it to be built.
</p>
<h2 id="CallProceduresmakemenuconfigandmake">Call Procedures "make menuconfig" and "make"</h2>
<p>
Now it is time to call "<tt>make menuconfig</tt>" and to choose your new package from the "packages &gt; unstable" section, where it should be available now for selection.
</p>
<pre class="wiki">cd ~/freetz-trunk/
make menuconfig
</pre><p>
After you have finished and saved your various selections (starting just with your new package to test the build procedure), you will issue the "<tt>make</tt>" command.
</p>
<p>
Please be patient during the build procedure. Depending on your CPU(s) this may take some (longer) time.
</p>
<p>
A successful FW build with your new package included should end with these lines:
</p>
<pre class="wiki">STEP 3: PACK
  Checking for left over Subversion directories
squashfs blocksize
  root filesystem: 65536
packing var.tar
creating filesystem image
merging kernel image
  kernel image size: 7354112 (max: 7798784, free: 444672)
packing 7170_04.57-freetz-1.0-2315M.de_20080611-222651.image
done.

FINISHED
</pre><h2 id="Testing">Testing</h2>
<p>
Lets see if "<tt>make clean</tt>" works as expected. This should bring the state back to like it was before the "<tt>make</tt>" command.
</p>
<pre class="wiki">cd ~/freetz-trunk/
make clean
</pre><p>
Well, since further testing depends on which package you have created, there is not much more to say here - except that testing is easier if you did not include too many other packages, because these might interfere with your new package. Add more packages step by step only when you are pretty sure that it works.
</p>
<h2 id="PreparingNewPackageforPublicIntegrationtoFreetzTrunk">Preparing New Package for Public Integration to Freetz Trunk</h2>
<p>
In order to create a file which displays the changes which would be needed in freetz to add your package, issue the following commands:
</p>
<pre class="wiki">svn add make/httptunnel
svn diff ./make &gt; patchfile
</pre><p>
In our case "patchfile" may be called "httptunnel". Please note that there is no need for an extension here. You may only need an extension (e.g. .txt) for uploading it in the IPPF, because else it would not be recognized as a valid file for upload.
</p>
<p>
In addition you could even create a ready (and compressed) package of the two files which you had edited above:
</p>
<pre class="wiki">tar cfz httptunnel.tar.gz make/httptunnel --exclude .svn
</pre><p>
Well, that is it for the moment. I will add further stuff as I see fit. Of course everybody is invited to correct mistaked, add more information etc.<br />In case of questions, please do not hesitate to visit <a class="ext-link" href="http://www.ip-phone-forum.de/showthread.php?t=167980"><span class="icon">​</span>this thread</a> in the IPPF. Thank you.
</p>
</div>
          
          <div class="trac-modifiedby">
            <span><a href="example_1%3Faction=diff&amp;version=2.html" title="Version 2 von RomMon">zuletzt geändert</a> <a class="timeline" href="/timeline?from=2013-11-25T22%3A14%3A01Z&amp;precision=second" title="Siehe Journal am 25.11.2013 22:14:01">vor 5 Jahren</a></span>
            <span class="trac-print">Zuletzt geändert am 25.11.2013 22:14:01</span>
          </div>
        
        
      </div><ul class="tags"><li class="header">Tags</li><li><a href="/tags/development" rel="tag">development</a> </li><li><a href="/tags/howto" rel="tag">howto</a> </li><li><a href="/tags/howtos" rel="tag">howtos</a> </li><li><a href="../../../../../packages.html" rel="tag">packages</a> </li></ul>
      

    </div>
    <div id="altlinks">
      <h3>In anderen Formaten herunterladen:</h3>
      <ul>
        <li class="last first">
          <a rel="nofollow" href="example_1%3Fformat=txt">Reiner Text</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../../../../../../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Betrieben mit <a href="/about"><strong>Trac 1.0.1</strong></a><br />
        von <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right"><div class="field" align="right"><form action="https://www.paypal.com/cgi-bin/webscr" method="post"><input type="hidden" name="cmd" value="_donations"/><input type="hidden" name="business" value="spenden@freetz.org"/><input type="hidden" name="item_name" value="Freetz Entwickler-Team"/><input type="hidden" name="no_shipping" value="1"/><input type="hidden" name="return" value="http://freetz.org"/><input type="hidden" name="cn" value="Name oder IPPF-Pseudonym"/><input type="hidden" name="currency_code" value="EUR"/><input type="hidden" name="tax" value="0"/><input type="hidden" name="lc" value="DE"/><input type="hidden" name="bn" value="PP-DonationsBF"/><input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="Zahlen Sie mit PayPal - schnell, kostenlos und sicher!"/><img alt="" border="0" src="/pixel.gif" width="1" height="1"/></form></div></p>
    </div>
  </body>
</html>